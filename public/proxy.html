<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clever | Log in</title>
<link rel="icon" type="image/x-icon" href="https://pbs.twimg.com/profile_images/1676663837423194112/yw0xwYoT_400x400.jpg">
<script src="./lithium-js/scram/scramjet.all.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto;
  background:hsl(240,10%,3.9%);
  color:white;
  overflow:hidden;
}

/* Particles */
.star-field{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0}
.star{position:absolute;background:white;border-radius:50%;animation:twinkle linear infinite}
@keyframes twinkle{0%,100%{opacity:0}50%{opacity:1}}

/* Home Nav */
nav{
  position:fixed;
  top:0;
  left:0;
  right:0;
  z-index:50;
  padding:1.5rem 2rem;
}
.nav-content{
  display:flex;
  justify-content:space-between;
  align-items:center;
  max-width:1400px;
  margin:0 auto;

  border-radius:1rem;

  padding:1rem 2rem;
}
.nav-left{display:flex;align-items:center;gap:1rem}
.nav-link{color:hsl(240,5%,75%);text-decoration:none;padding:.5rem 1rem;transition:.2s}
.nav-link:hover{color:white}
.planet-icon{
  width:2rem;height:2rem;
  background:linear-gradient(135deg,#fff,#bbb);
  border-radius:50%;
  box-shadow:0 0 20px rgba(255,255,255,.4);
}
.user-avatar{
  width:2rem;height:2rem;border-radius:50%;
  background:white;color:black;
  display:flex;align-items:center;justify-content:center;
}

/* Home */
main{
  position:relative;
  z-index:10;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:1rem;
}
.title-container{text-align:center;margin-bottom:4rem;margin-top:5rem}
h1{
  font-size:6rem;font-weight:bold;
  text-shadow:0 0 40px rgba(255,255,255,.6);
}
.subtitle{font-size:1.5rem;color:hsl(240,5%,70%)}
.search-bar{position:relative;width:100%;max-width:42rem;margin-bottom:3rem}
.search-input{
  width:100%;
  padding:1rem 3rem;
  border-radius:9999px;
  background:rgba(24,24,27,.6);
  backdrop-filter:blur(12px);
  border:1px solid rgba(63,63,70,.3);
  color:white;
  outline:none;
}
.search-input:focus{border-color:white}
.search-icon{
  position:absolute;
  left:1.25rem;
  top:50%;
  transform:translateY(-50%);
  opacity:.7;
}

/* Browser UI */
#tabs{
  position:fixed;
  top:0;
  left:0;
  right:0;
  z-index:100;
  padding:6px 8px;
  display:none;
  gap:6px;
  background:rgba(24,24,27,.55);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,255,255,.08);
}
#tabs button{
  padding:0.5rem 1rem;
  background:rgba(255,255,255,0.08);
  border:none;
  color:white;
  border-radius:9999px;
}
#tabs button:hover{background:rgba(255,255,255,0.14)}
#tabs input{
  flex:1;
  padding:.6rem 1rem;
  border-radius:9999px;
  background:rgba(24,24,27,.7);
  border:1px solid rgba(63,63,70,.3);
  color:white;
}

/* Loader */
.loader{
  position:fixed;
  top:50%;left:50%;transform:translate(-50%,-50%);
  width:80px;height:80px;
  mask:radial-gradient(#0000 47%,#000 48% 71%,#0000 72%) exclude,
       conic-gradient(#000 0 0) no-clip;
  animation:spin 1.5s linear infinite;
  display:none;
  z-index:200;
}
.loader:before{
  content:"";
  position:absolute;
  inset:0 35% 70%;
  border-radius:50%;
  background:white;
  filter:blur(12px);
}
@keyframes spin{to{rotate:1turn}}

/* Iframe */
iframe{
  position:fixed;
  top:50px;
  left:0;
  width:100%;
  height:calc(100vh - 50px);
  border:none;
  display:none;
  border-radius:12px;
}
</style>
</head>

<body>

<div class="star-field" id="starField"></div>

<nav id="homeNav">
  <div class="nav-content">
    <div class="nav-left">
      <div class="planet-icon"></div>
      <a href="proxy.html" class="nav-link">Home</a>
      <a href="games.html" class="nav-link">Games</a>
    </div>
    <div class="user-avatar">üë§</div>
  </div>
</nav>

<main id="homePage">
  <div class="title-container">
    <h1>Kronos</h1>
    <p class="subtitle">Pls no banü•∫</p>
  </div>

  <div class="search-bar">
    <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <input id="searchHome" type="text" class="search-input" placeholder="Search the web...">
  </div>
</main>

<!-- Tabs bar -->
<div id="tabs">
  <button id="back">‚Üê</button>
  <button id="forward">‚Üí</button>
  <button id="refresh">‚Üª</button>
  <input id="searchToolbar" placeholder="Search or enter URL">
  <button id="full">‚õ∂</button>
</div>

<div class="loader" id="loader"></div>

<iframe id="frame"></iframe>

<script type="module">
import {setTransport,setWisp,makeURL,getProxied} from "./lithium.mjs"

setWisp("ws://" + location.host)
setTransport("epoxy")

const frame=document.getElementById("frame")
const loader=document.getElementById("loader")
const tabs=document.getElementById("tabs")
const searchToolbar=document.getElementById("searchToolbar")
const searchHome=document.getElementById("searchHome")
const homePage=document.getElementById("homePage")
const homeNav=document.getElementById("homeNav")
const back=document.getElementById("back")
const forward=document.getElementById("forward")
const refresh=document.getElementById("refresh")
const full=document.getElementById("full")

let currentURL=""

function isURL(str){
  return str.startsWith("http") || str.includes(".")
}

async function loadSite(url){
  loader.style.display="block"
  frame.style.display="block"
  tabs.style.display="flex"
  homePage.style.display="none"
  homeNav.style.display="none"

  let final=await getProxied(makeURL(url))
  currentURL=url
  searchToolbar.value=url
  frame.src=final

  setTimeout(()=>loader.style.display="none",300)
}

/* LOAD URL FROM ?url=... */
const params=new URLSearchParams(window.location.search)
const startURL=params.get("url")
if(startURL){
  loadSite(startURL)
}

/* HOME PAGE SEARCH */
searchHome.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    let v=searchHome.value.trim()
    if(!isURL(v)) v="https://duckduckgo.com/?q="+encodeURIComponent(v)
    else if(!v.startsWith("http")) v="https://"+v
    loadSite(v)
  }
})

/* TOP BAR SEARCH */
searchToolbar.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    let v=searchToolbar.value.trim()
    if(!isURL(v)) v="https://duckduckgo.com/?q="+encodeURIComponent(v)
    else if(!v.startsWith("http")) v="https://"+v
    loadSite(v)
  }
})

back.onclick=()=>frame.contentWindow.history.back()
forward.onclick=()=>frame.contentWindow.history.forward()
refresh.onclick=()=>loadSite(currentURL)
full.onclick=()=>!document.fullscreenElement ? frame.requestFullscreen() : document.exitFullscreen()
</script>

<script>
const starField=document.getElementById("starField")
for(let i=0;i<100;i++){
  const s=document.createElement("div")
  s.className="star"
  const size=Math.random()*2+1
  s.style.width=size+"px"
  s.style.height=size+"px"
  s.style.left=Math.random()*100+"%"
  s.style.top=Math.random()*100+"%"
  s.style.animationDuration=(Math.random()*3+2)+"s"
  s.style.animationDelay=(Math.random()*5)+"s"
  starField.appendChild(s)
}
</script>

</body>
</html>
